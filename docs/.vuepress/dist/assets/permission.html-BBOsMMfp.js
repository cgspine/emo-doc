import{_ as s,c as a,a as e,o as p}from"./app-CTIoDS1N.js";const t="/images/permission.jpg",i={};function l(o,n){return p(),a("div",null,n[0]||(n[0]=[e('<h1 id="权限" tabindex="-1"><a class="header-anchor" href="#权限"><span>权限</span></a></h1><p>国内现在的审核机制，基本上都需要在申请权限时要出一个申请权限的理由，目前的交互设计都趋于归一化（如下图），因为 <code>emo</code> 做了统一的封装。</p><img width="280" alt="权限申请示例" src="'+t+`"><blockquote><p>注：此库不包含对特定权限的兼容性处理</p></blockquote><h2 id="依赖引入" tabindex="-1"><a class="header-anchor" href="#依赖引入"><span>依赖引入</span></a></h2><div class="language-kts line-numbers-mode" data-highlighter="prismjs" data-ext="kts" data-title="kts"><pre><code><span class="line"><span class="token comment">// 此组件依赖了 modal 组件</span></span>
<span class="line"><span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;cn.qhplus.emo:permission&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><ol><li>通过 <code>rememberEmoPermissionState</code> 获取 <code>permissionState</code></li></ol><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token keyword">val</span> permissionState <span class="token operator">=</span> <span class="token function">rememberEmoPermissionState</span><span class="token punctuation">(</span></span>
<span class="line">    permission <span class="token operator">=</span> Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">,</span></span>
<span class="line">    tipContent <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;为了录入羞羞的事情申请个相机权限&quot;</span></span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你也可以通过传入 <code>EmoPermissionTip</code> 自定义提示信息, <code>EmoPermissionTip</code> 的定义为：</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token keyword">interface</span> EmoPermissionTip <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation builtin">@Composable</span></span>
<span class="line">    <span class="token keyword">fun</span> AnimatedVisibilityScope<span class="token punctuation">.</span><span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>通过 <code>permissionState.status</code> 判断权限是否已经被允许，</li></ol><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token keyword">when</span> <span class="token punctuation">(</span>permissionState<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    PermissionStatus<span class="token punctuation">.</span>Granted <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 权限已获取</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">is</span> PermissionStatus<span class="token punctuation">.</span>Denied <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>shouldShowRationale<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            权限未申请</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>通过 <code>permissionState.launchPermissionRequest()</code> 申请权限。</p></li><li><p>如果你想一次性申请多个权限，则使用 <code>rememberEmoMultiplePermissionsState</code>。</p></li></ol><p><strong>完整 Demo</strong></p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalPermissionsApi<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation builtin">@Composable</span></span>
<span class="line"><span class="token keyword">fun</span> <span class="token function">PermissionDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> permissionState <span class="token operator">=</span> <span class="token function">rememberEmoPermissionState</span><span class="token punctuation">(</span></span>
<span class="line">        permission <span class="token operator">=</span> Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">,</span></span>
<span class="line">        tipContent <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;为了录入羞羞的事情申请个相机权限&quot;</span></span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">val</span> view <span class="token operator">=</span> LocalView<span class="token punctuation">.</span>current</span>
<span class="line">    <span class="token keyword">val</span> status <span class="token operator">=</span> permissionState<span class="token punctuation">.</span>status</span>
<span class="line">    <span class="token function">CommonItem</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;申请单个权限&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">when</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            PermissionStatus<span class="token punctuation">.</span>Granted <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                view<span class="token punctuation">.</span><span class="token function">emoToast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;权限已经获取啦&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">is</span> PermissionStatus<span class="token punctuation">.</span>Denied <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 申请权限</span></span>
<span class="line">                permissionState<span class="token punctuation">.</span><span class="token function">launchPermissionRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">val</span> text <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        PermissionStatus<span class="token punctuation">.</span>Granted <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-literal singleline"><span class="token string">&quot;已获取权限&quot;</span></span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">is</span> PermissionStatus<span class="token punctuation">.</span>Denied <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>shouldShowRationale<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-literal singleline"><span class="token string">&quot;你不应该拒绝这个权限&quot;</span></span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-literal singleline"><span class="token string">&quot;点击获取权限&quot;</span></span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">Text</span><span class="token punctuation">(</span></span>
<span class="line">        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>horizontal <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span> vertical <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        text <span class="token operator">=</span> text<span class="token punctuation">,</span></span>
<span class="line">        color <span class="token operator">=</span> Color<span class="token punctuation">.</span>DarkGray</span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更多信息请查看公众号文章 <a href="https://mp.weixin.qq.com/s?__biz=Mzk0OTMzMjE2OQ==&amp;mid=2247483884&amp;idx=1&amp;sn=45cc1fc656ec5daaf1eab464cf9090ee&amp;chksm=c358b04af42f395c8a95061526e2ad23fbae7906cabc5182cdfb4116ceba07d39a3836c2a8bd&amp;token=1864276121&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">这权限提示的交互，迟早会抄袭到大一统</a></p></blockquote>`,17)]))}const u=s(i,[["render",l],["__file","permission.html.vue"]]),r=JSON.parse('{"path":"/guide/permission.html","title":"权限","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"依赖引入","slug":"依赖引入","link":"#依赖引入","children":[]},{"level":2,"title":"使用","slug":"使用","link":"#使用","children":[]}],"git":{"updatedTime":1692869469000,"contributors":[{"name":"cgspine","email":"cgspine@gmail.com","commits":6}]},"filePathRelative":"guide/permission.md"}');export{u as comp,r as data};
